<!DOCTYPE HTML>
<html class="no-js" lang="en">

  <head>
  <meta charset="utf-8">
  <title>Absinthe: Our First Query</title>
  <link rel="stylesheet" href="/css/main.css">

  <!-- ok >

  <!-- you don't need to keep this, but it's cool for stats! -->
  <meta name="generator" content="Nanoc 4.1.4">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">


  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/img/favicon.ico">

  <script src="/js/main.js"></script>
</head>


<body class="preload markdown-body series">

  <header id="page-header" role="banner">
  <a href="/"><h1 class="logo">Absinthe</h1></a>
  <a id="mobile-menu" class="js-mobile-nav">Navigation Menu</a>
<nav id="main-navigation">
  <ol>
    <li><a href='/learning-graphql/'>GraphQL?</a></li>
    <li><a href='/tutorial/' class="active">Tutorial</a></li>
    <li><a href='/guides/'>Guides</a></li>
    <li><a href='/community/'>Community</a></li>
    <li><a href='/projects/'>Projects</a></li>
    <li>
      <a class="icon-link" target="github" href="https://github.com/absinthe-graphql">
        <svg aria-hidden="true" height="28" role="img" version="1.1" viewBox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z"></path></svg>
      </a>
    </li>
  </ol>
</nav>

</header>


  <main id="main">
    <nav id="page-navigation">
  <p class="page-navigation-header">tutorial</p>
  <ol>
    
      <li><a href='/tutorial/'>Introduction</a></li>
    
      <li><a href='/tutorial/our-first-query/' class="active">Our First Query</a></li>
    
      <li><a href='/tutorial/query-arguments/'>Query Arguments</a></li>
    
      <li><a href='/tutorial/mutations/'>Mutations</a></li>
    
      <li><a href='/tutorial/scalar-types/'>Scalar Types</a></li>
    
      <li><a href='/tutorial/complex-arguments/'>Complex Arguments</a></li>
    
      <li><a href='/tutorial/conclusion/'>Conclusion</a></li>
    
  </ol>
</nav>


    <article>
      <header>
        <h1>Our First Query</h1>
      </header>
      
<p>The first thing our viewers want is a list of our blog posts, so
that’s what we’re going to give them. Here’s the query we want to
support:</p>

<figure class="codeblock"><pre><code class="language-graphql highlight"><span class="err">{</span>
  <span class="n">posts</span> <span class="err">{</span>
    <span class="n">title</span>
    <span class="n">body</span>
  <span class="err">}</span>
<span class="err">}</span></code></pre>
<figcaption class="description">A simple query</figcaption>
</figure>

<p>To do this we’re going to need a schema. Let’s create some basic types
for our schema, starting with a Post. GraphQL has several fundamental
types on top of which all of our types will be built. The
<a href="https://hexdocs.pm/absinthe/Absinthe.Type.Object.html">Object</a> type is
the right one to use when representing a set of key value pairs.</p>

<figure class="codeblock"><figcaption class="filename">web/schema/types.ex</figcaption>
<pre><code class="language-elixir highlight"><span class="k">defmodule</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Schema</span><span class="o">.</span><span class="no">Types</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Schema</span><span class="o">.</span><span class="no">Notation</span>

  <span class="n">object</span> <span class="ss">:post</span> <span class="k">do</span>
    <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:id</span>
    <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:string</span>
    <span class="n">field</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</figure>

<p class="notice">
The GraphQL specification requires that type names be unique, TitleCased words.
Absinthe does this automatically for us, extrapolating from our type identifier
(in this case <code>:post</code> gives us <code>"Post"</code>). If really
needed, we could provide a custom type name as a <code>:name</code> option to
the <code>object</code> macro.
</p>

<p>If you’re curious what the type <code>:id</code> is used by the <code>:id</code> field, see the
<a href="https://facebook.github.io/graphql/#sec-ID">GraphQL spec</a>. It’s an opaque
value, and in our case is just the regular Ecto id, but serialized as a string.</p>

<p>With our type completed we can now write a basic schema that will let us query a
set of posts.</p>

<figure class="codeblock"><figcaption class="filename">web/schema.ex</figcaption>
<pre><code class="language-elixir highlight"><span class="k">defmodule</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Schema</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Schema</span>
  <span class="n">import_types</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Schema</span><span class="o">.</span><span class="no">Types</span>

  <span class="n">alias</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Resolver</span>

  <span class="n">query</span> <span class="k">do</span>
    <span class="n">field</span> <span class="ss">:posts</span><span class="p">,</span> <span class="n">list_of</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">resolve</span> <span class="o">&amp;</span><span class="no">Resolver</span><span class="o">.</span><span class="no">Post</span><span class="o">.</span><span class="n">all</span><span class="o">/</span><span class="m">2</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre>
</figure>

<figure class="codeblock"><figcaption class="filename">web/resolver/post.ex</figcaption>
<pre><code class="language-elixir highlight"><span class="k">defmodule</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Resolver</span><span class="o">.</span><span class="no">Post</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">all</span><span class="p">(</span><span class="n">_args</span><span class="p">,</span> <span class="n">_info</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Repo</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="no">Post</span><span class="p">)}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</figure>

<p>Queries are defined as fields inside the GraphQL object returned by
our <code>query</code> function. We created a posts query that has a type
<code>list_of(:post)</code> and is resolved by our <code>Blog.Resolver.Post.all/2</code>
function. Later we’ll get into what the arguments to resolver
functions are; don’t worry about it for now. The resolver function can
be anything you like that takes the requisite 2 arguments.</p>

<p>For more information on the macros
available to build a schema, see
definitions see <a href="https://hexdocs.pm/absinthe/Absinthe.Schema.html">Absinthe.Schema</a>
and <a href="https://hexdocs.pm/absinthe/Absinthe.Schema.Notation.html">Absinthe.Schema.Notation</a>.</p>

<p>The last thing we need to do is configure our Phoenix router to use our newly
created schema.</p>

<figure class="codeblock"><figcaption class="filename">web/router.ex</figcaption>
<pre><code class="language-elixir highlight"><span class="k">defmodule</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Web</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">Router</span>

  <span class="n">forward</span> <span class="sd">"</span><span class="s2">/"</span><span class="p">,</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Plug</span><span class="p">,</span>
    <span class="ss">schema:</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Schema</span>
<span class="k">end</span></code></pre>
</figure>

<p>That’s it! We’re running GraphQL.</p>

<p>Using <code>Absinthe.Plug</code> in your router ensures that your schema is type
checked at compile time. This means that if you misspell a type and do
<code>list_of(:pots)</code> you’ll be notified that the type you reference in
your schema doesn’t exist.</p>

      
        <p class="next">
          Next: Read
          <a href="/tutorial/query-arguments/">"Query Arguments"</a>
        </p>
      
    </article>

  </main>

  <footer id="page-footer">
  <p>Please report any issues & contribute changes to the <a href="https://github.com/absinthe-graphql/website" target="github-website">website repository</a>. Thanks!</p>
  <p>Background image <a href="https://www.flickr.com/photos/anitacanita/4635683623">"green"</a> by Ana C., license available <a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">here</a>.</p>
</footer>


</body>
</html>
