<!DOCTYPE HTML>
<html class="no-js" lang="en">

  <head>
  <meta charset="utf-8">
  <title>Absinthe: Complex Arguments</title>
  <link rel="stylesheet" href="/css/main.css">

  <!-- ok >

  <!-- you don't need to keep this, but it's cool for stats! -->
  <meta name="generator" content="Nanoc 4.1.4">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">


  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/img/favicon.ico">

  <script src="/js/main.js"></script>
</head>


<body class="preload markdown-body series">

  <header id="page-header" role="banner">
  <a href="/"><h1 class="logo">Absinthe</h1></a>
  <a id="mobile-menu" class="js-mobile-nav">Navigation Menu</a>
<nav id="main-navigation">
  <ol>
    <li><a href='/learning-graphql/'>GraphQL?</a></li>
    <li><a href='/tutorial/' class="active">Tutorial</a></li>
    <li><a href='/guides/'>Guides</a></li>
    <li><a href='/community/'>Community</a></li>
    <li><a href='/projects/'>Projects</a></li>
    <li>
      <a class="icon-link" target="github" href="https://github.com/absinthe-graphql">
        <svg aria-hidden="true" height="28" role="img" version="1.1" viewBox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z"></path></svg>
      </a>
    </li>
  </ol>
</nav>

</header>


  <main id="main">
    <nav id="page-navigation">
  <p class="page-navigation-header">tutorial</p>
  <ol>
    
      <li><a href='/tutorial/'>Introduction</a></li>
    
      <li><a href='/tutorial/our-first-query/'>Our First Query</a></li>
    
      <li><a href='/tutorial/query-arguments/'>Query Arguments</a></li>
    
      <li><a href='/tutorial/mutations/'>Mutations</a></li>
    
      <li><a href='/tutorial/scalar-types/'>Scalar Types</a></li>
    
      <li><a href='/tutorial/complex-arguments/' class="active">Complex Arguments</a></li>
    
      <li><a href='/tutorial/conclusion/'>Conclusion</a></li>
    
  </ol>
</nav>


    <article>
      <header>
        <h1>Complex Arguments</h1>
      </header>
      
<p>In preparation for supporting comments on our blog, let’s create users. We’re building
a modern mobile first blog of course, and thus want to support either a phone number
or an email as the contact method for a user.</p>

<p>We want to support the following mutations.</p>

<figure class="codeblock"><pre><code class="language-graphql highlight"><span class="c1">#description "User with email"</span>
<span class="k">mutation</span> <span class="n">CreateEmailUser</span> <span class="err">{</span>
  <span class="n">user</span><span class="err">(</span><span class="ss">contact:</span> <span class="err">{</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">email"</span><span class="err">,</span> <span class="ss">value:</span> <span class="sd">"</span><span class="s2">foo@bar.com"</span><span class="err">},</span> <span class="ss">password:</span> <span class="sd">"</span><span class="s2">hunter2"</span><span class="err">)</span>
<span class="err">}</span></code></pre>
</figure>

<figure class="codeblock"><pre><code class="language-graphql highlight"><span class="c1">#description "User with phone number"</span>
<span class="k">mutation</span> <span class="n">CreateEmailUser</span> <span class="err">{</span>
  <span class="n">user</span><span class="err">(</span><span class="ss">contact:</span> <span class="err">{</span><span class="ss">type:</span> <span class="sd">"</span><span class="s2">phone"</span><span class="err">,</span> <span class="ss">value:</span> <span class="sd">"</span><span class="s2">foo@bar.com"</span><span class="err">},</span> <span class="ss">password:</span> <span class="sd">"</span><span class="s2">hunter2"</span><span class="err">)</span>
<span class="err">}</span></code></pre>
</figure>

<p>To do this we need the ability to create nested arguments. GraphQL has InputObjects
for this purpose. InputObjects are key value pairs just like regular Objects, but
designed for input (you can’t do circular references with them for example).</p>

<p>Another notion we’ll look at here is an Enum type. We only want to support contact
types <code>"email"</code> and <code>"phone"</code> at the moment, and GraphQL gives us the ability to
specify this in our schema.</p>

<p>Let’s start with our contact_type Enum.</p>

<figure class="codeblock"><figcaption class="filename">web/schema/types.ex</figcaption>
<pre><code class="language-graphql highlight"><span class="k">enum</span> <span class="ss">:contact_type</span> <span class="n">do</span>
  <span class="n">values</span> <span class="err">~</span><span class="n">w</span><span class="err">(</span><span class="n">phone</span> <span class="n">email</span><span class="err">)</span><span class="n">a</span>
<span class="n">end</span></code></pre>
</figure>

<p>Easy! Now if a user tries to send some other kind of contact type they’ll get a
nice error without any extra effort on your part. Enum types are not a substitute
for modeling layer validations however, be sure to still enforce things like this
on that layer too.</p>

<p>Now for our contact input object.</p>

<figure class="codeblock"><figcaption class="filename">web/schema/types.ex</figcaption>
<pre><code class="language-graphql highlight"><span class="n">input_object</span> <span class="ss">:contact_input</span> <span class="n">do</span>
  <span class="n">field</span> <span class="ss">:type</span><span class="err">,</span> <span class="n">non_null</span><span class="err">(</span><span class="ss">:contact_type</span><span class="err">)</span>
  <span class="n">field</span> <span class="ss">:value</span><span class="err">,</span> <span class="n">non_null</span><span class="err">(</span><span class="ss">:string</span><span class="err">)</span>
<span class="n">end</span></code></pre>
</figure>

<p>Note that we name this type <code>:contact_input</code>. We may also want a regular <code>:contact</code>
object and types share a global namespace. In general it often makes sense to
suffix your input object type names with <code>_input</code></p>

<p>Finally our schema:</p>

<figure class="codeblock"><figcaption class="filename">web/schema.ex</figcaption>
<pre><code class="language-elixir highlight"><span class="n">mutation</span> <span class="k">do</span>

  <span class="c1">#... other mutations</span>

  <span class="n">field</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">arg</span> <span class="ss">:contact</span><span class="p">,</span> <span class="n">non_null</span><span class="p">(</span><span class="ss">:contact_input</span><span class="p">)</span>
    <span class="n">arg</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:string</span>

    <span class="n">resolve</span> <span class="o">&amp;</span><span class="no">Resolver</span><span class="o">.</span><span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="o">/</span><span class="m">2</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre>
</figure>

<p>Suppose in our database that we store contact information in a different database
table. Our resolver would be used to create both rows in this case.</p>

<p>There does not need to be a one to one correspondence between how data is structured
in your underlying data store and how things are presented by your GraphQL api.</p>

<p>Our resolver might look something like this:</p>

<figure class="codeblock"><figcaption class="filename">web/resolver/post.ex</figcaption>
<pre><code class="language-elixir highlight"><span class="k">def</span> <span class="n">create</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">_info</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="n">contact_params</span><span class="p">,</span> <span class="n">user_params</span><span class="p">}</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="ss">:contact</span><span class="p">)</span>

  <span class="n">with</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">contact</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="n">create_contact</span><span class="p">(</span><span class="n">contact_params</span><span class="p">),</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">user</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="n">create_user</span><span class="p">(</span><span class="n">user_params</span><span class="p">,</span> <span class="n">contact</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">%{</span><span class="n">user</span> <span class="o">|</span> <span class="ss">contact:</span> <span class="n">contact</span><span class="p">}}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">create_contact</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">params</span>
  <span class="o">|&gt;</span> <span class="no">Contact</span><span class="o">.</span><span class="n">changeset</span>
  <span class="o">|&gt;</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Repo</span><span class="o">.</span><span class="n">insert</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">create_user</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">contact</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">params</span>
  <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:contact_id</span><span class="p">,</span> <span class="n">contact</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="o">|&gt;</span> <span class="no">User</span><span class="o">.</span><span class="n">changeset</span>
  <span class="o">|&gt;</span> <span class="no">Blog</span><span class="o">.</span><span class="no">Repo</span><span class="o">.</span><span class="n">insert</span>
<span class="k">end</span></code></pre>
</figure>

      
        <p class="next">
          Next: Read
          <a href="/tutorial/conclusion/">"Conclusion"</a>
        </p>
      
    </article>

  </main>

  <footer id="page-footer">
  <p>Please report any issues & contribute changes to the <a href="https://github.com/absinthe-graphql/website" target="github-website">website repository</a>. Thanks!</p>
  <p>Background image <a href="https://www.flickr.com/photos/anitacanita/4635683623">"green"</a> by Ana C., license available <a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">here</a>.</p>
</footer>


</body>
</html>
